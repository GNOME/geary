#
# Geary CI config.
#

stages:
  - build

variables:
  BUILD_DIR: build
  FEDORA_DEPENDENCIES: vala gobject-introspection-devel
                meson desktop-file-utils libcanberra-devel libgee-devel
                glib2-devel gmime-devel gtk3-devel libnotify-devel sqlite-devel
                webkitgtk4-devel libsecret-devel libxml2-devel vala-tools
                gcr-devel enchant-devel libunwind-devel
                gnome-online-accounts-devel itstool

#
# Stages
#

fedora:
  stage: build
  image: fedora:latest
  before_script:
    - dnf update -y --nogpgcheck
    - dnf install -y --nogpgcheck $FEDORA_DEPENDENCIES
  script:
    - meson --buildtype=debug build
    - ninja -v -C $BUILD_DIR
    - meson test -v --no-stdsplit -C $BUILD_DIR engine-tests
    - ninja -v -C $BUILD_DIR install
